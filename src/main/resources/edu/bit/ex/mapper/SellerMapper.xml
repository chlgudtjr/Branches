<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="edu.bit.ex.mapper.SellerMapper">

<!-- 상품조회 검색기능 + 페이징 -->
	<sql id="criteria">
		<trim prefix="(" suffix=") AND " prefixOverrides="OR">
			<foreach item='type' collection="typeArr">
				<trim prefix="OR">
					<choose>
						<when test="type == 'T'.toString()">
							p.prdct_name like '%' || #{keyword} || '%'
						</when>
						<when test="type == 'C'.toString()">
							b.prdct_id like '%' || #{keyword} || '%'
						</when>
					</choose>
				</trim>
			</foreach>
		</trim>	
	</sql>
	
	<select id="getbNumDesc" resultType="edu.bit.ex.joinvo.PrdctRegisterImageVO">
		<![CDATA[
			SELECT * FROM (
		 	select rownum rn, b.board_id, b.board_date, b.prdct_id, p.prdct_name, p.prdct_price
		 	from board b, prdct p
		 	where (b.board_type_number = 6 and b.prdct_id = p.prdct_id) and
		]]>
		
		<include refid="criteria"></include>
		
		<![CDATA[
			rownum <= #{pageNum} * #{amount}
			)
		where rn > (#{pageNum} -1) * #{amount}
		]]>
	</select>
	
	<select id="getPrdTotal" resultType="int">
		select count(*) from board b, prdct p where 
		
		<include refid="criteria"></include>
		
		board_id > 0 and b.prdct_id = p.prdct_id
	</select>
	
	<!-- 상품 게시판 아이디 게시판 유형이 6번인거 불러오기 및 페이징-->
	<!-- <select id="getbNumDesc" resultType="edu.bit.ex.joinvo.PrdctRegisterImageVO" >
		<![CDATA[
			SELECT * FROM (
			     SELECT ROWNUM AS RNUM, A.* FROM (
			        	select b.board_id, b.board_date, b.prdct_id, p.prdct_name, p.prdct_price from board b, prdct p
							where b.board_type_number = 6 and b.prdct_id = p.prdct_id order by b.board_id DESC
			    ) A WHERE ROWNUM <= #{pageNum} * #{amount}
			) WHERE RNUM > (#{pageNum}-1) * #{amount}
	
		]]>
	</select>
	
	<select id="getPrdTotal" resultType="int" >
		<![CDATA[			
			select count(*) from board b, prdct p where b.prdct_id = p.prdct_id
		]]>
	</select> -->
	
	<!-- 상품 카테고리 불러오기 -->
	<select id="getCategory" resultType="edu.bit.ex.vo.CategoryVO">
			<![CDATA[
				select c.category_name,p.prdct_id from category c, prdct p where c.category_number = p.category_number order by p.category_number desc
			]]>
	</select>

	<!-- 판매자 주소 불러오기 -->
	<select id="getAddress" resultType="edu.bit.ex.vo.ShippingVO">
			<![CDATA[
				select shipping_address from shipping where mbr_id = 'prism'
			]]>
	</select>

	<!-- 상품정보 불러오기1 -->
	<select id="getOption" resultType="edu.bit.ex.vo.PrdctVO">
		<![CDATA[
			select * from prdct where prdct_id = #{prdct_id}
		]]>
	</select>
	
	<!-- 상품 내용 불러오기 -->
	<select id="getContent" resultType="edu.bit.ex.vo.BoardVO" >
		<![CDATA[			
			select board_content from board where prdct_id = #{prdct_id} 
		]]>
	</select>
	
	<!-- 주문상품 정보 불러오기 - 상품번호, 상품명 등...?  -->
	<select id="getPrdOrder" resultType="edu.bit.ex.vo.PrdctOrderVO">
		<![CDATA[
			select * from prdct_order
		]]>
	</select>

	<!-- 메인페이지 주문정보 불러오기 -->
	<select id="getProduct" resultType="edu.bit.ex.joinvo.PrdctRegisterImageVO">
		<![CDATA[
			select * from prdct p, board b where b.prdct_id = p.prdct_id
		]]>
	</select>
	
	<!-- 메인페이지 주문정보 불러오기2-->
	<select id="getOrderDetail" resultType="edu.bit.ex.vo.OrderDetailVO">
		<![CDATA[
			select * from order_detail
		]]>
	</select>
	
	<!-- 게시글 정보 불러오기 -->
	<!-- <select id="getBoard" resultType="edu.bit.ex.vo.BoardVO">
		<![CDATA[
			select * from board
		]]>
	</select> -->
	<!-- 게시글 검색기능 + 페이징 -->
	<sql id="searchCriteria">
		<trim prefix="(" suffix=") AND " prefixOverrides="OR">
			<foreach item='type' collection="typeArr">
				<trim prefix="OR">
					<choose>
						<when test="type == 'T'.toString()">
							board_name like '%' || #{keyword} || '%'
						</when>
						<when test="type == 'C'.toString()">
							board_id like '%' || #{keyword} || '%'
						</when>
						<when test="type == 'W'.toString()">
							mbr_id like '%' || #{keyword} || '%'
						</when>
					</choose>
				</trim>
			</foreach>
		</trim>	
	</sql>
	
	<select id="getBoard" resultType="edu.bit.ex.vo.BoardVO">
		<![CDATA[
			SELECT  
				*
		 FROM (
		 	select rownum rn, b.board_id, b.board_name, b.board_content, b.mbr_id, b.board_date, b.board_type_number, p.prdct_name
		 	from board b , prdct p
		 	where (b.board_type_number = 6 and b.prdct_id = p.prdct_id) and
		]]>
		
		<include refid="searchCriteria"></include>
		
		<![CDATA[
			rownum <= #{pageNum} * #{amount}
			)
		where rn > (#{pageNum} -1) * #{amount}	
		]]>
	</select>
	
	<select id="getTotal" resultType="int">
		select count(*) from board where
		
		<include refid="searchCriteria"></include>
		
		board_id > 0 and board_type_number = 6
	</select>
	

	
	<!-- 판매자 정보 불러오기 (수정할 때) -->	
	<select id="getMemberInfo" resultType="edu.bit.ex.vo.MbrVO">
		<![CDATA[
			select * from mbr where mbr_id='prism'
		]]>
	</select>	
	
	<!-- 판매자 정보 수정 admin seller-->
	<update id="sellerInfoUpdate">
	<![CDATA[
		update mbr set mbr_name=#{mbr_name}, mbr_pw=#{mbr_pw}, mbr_email=#{mbr_email}, contact_number=#{contact_number}  where mbr_id=#{mbr_id}
	]]>
	</update>
	
	<!-- 상품등록하기 -->
	<insert id="prdInsert">
		<![CDATA[
			insert all into prdct (prdct_id, prdct_name, prdct_price, category_number, prdct_color, prdct_size, prdct_stock, mbr_id) values
				(#{prdct_id},#{prdct_name}, #{prdct_price}, #{category_number},#{prdct_color},#{prdct_size},#{prdct_stock}, #{mbr_id}) 
					into board (board_id, board_name, board_content, board_type_number, prdct_id ,board_like, board_hit, mbr_id) 
						values(board_seq.nextval, 'TEST', #{board_content}, 6, #{prdct_id} ,0, 0, #{mbr_id})
							select * from dual
		]]>
	</insert>
	
	<!-- 판매자 상품정보 삭제... -->
	<delete id="prdctDelete">
	<![CDATA[
		delete from prdct where prdct_id = #{prdct_id}
	]]>
	</delete>
	
	<!-- 썸네일 불러오기 -->
	<select id="prdctThumbnail" resultType="edu.bit.ex.vo.PrdctVO">
	<![CDATA[
		select * from prdct
	]]>
	</select>
	
	<!-- 판매자 등록상품 불러오기 (수정페이지) -->
	<select id="getPrdctInfo" resultType="edu.bit.ex.vo.PrdctVO">
	<![CDATA[
		select * from prdct where prdct_id = #{prdct_id}
	]]>
	</select>
	
	<!-- 판매자 등록상품 수정(상품내용) -->
	<update id="updatePrdctInfo">
	<![CDATA[
		update prdct set prdct_name=#{prdct_name}, category_number=#{category_number}, prdct_color=#{prdct_color}, prdct_size = #{prdct_size}
							,prdct_price=#{prdct_price}, prdct_stock=#{prdct_stock}, prdct_thumbnail=#{prdct_thumbnail} where prdct_id=#{prdct_id}
	]]>
	</update>
	
	<!-- 판매자 상품내용 수정2 (board_content내용)-->
	<update id="prdctContentUpdate">
	<![CDATA[
		update board set board_content=#{board_content} where prdct_id=#{prdct_id}
	]]>
	</update>
	
</mapper>
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="edu.bit.ex.mapper.BoardMapper">
	<!-- 공지사항 게시판 리스트 -->
	<resultMap id="noticeBoardMap" type="edu.bit.ex.vo.BoardVO">
	    <result property="board_id" column="board_id"/>
	    <result property="board_name" column="board_name"/>
	    <result property="board_date" column="board_date"/>
		<collection property="board_type_number" resultMap="noticeBoardTypeMap"></collection>
	</resultMap>	
	<resultMap id="noticeBoardTypeMap" type="edu.bit.ex.vo.BoardTypeVO">
		<result property="board_type_number" column="board_type_number"/>
		<result property="board_type_name" column="board_type_name"/>
	</resultMap>
	<select id="getNoticeList" resultMap="noticeBoardMap">
		SELECT b.board_id, b.board_name, b.board_date 
		FROM board b, board_type t 
		WHERE b.board_type_number = t.board_type_number AND 
		    t.board_type_name = 'NOTICE' 
		ORDER BY b.board_id DESC, b.board_date DESC 
	</select>
	
	<!-- 페이징을 적용한 게시글 불러오기 -->
	<select id="getNoticeListWithPaging" resultType="edu.bit.ex.vo.BoardVO">
		<![CDATA[
			SELECT * FROM (
			     SELECT ROWNUM AS RNUM, A.* FROM (
			        		SELECT
			                    *
			                FROM
			                    board 
			                ORDER BY board_id DESC, board_date DESC  
			    ) A WHERE ROWNUM <= #{pageNum} * #{amount}
			) WHERE RNUM > (#{pageNum}-1) * #{amount}
		]]>
	</select>
	
	<!-- 페이징이 적용되는 게시글 수 단위 -->
	<select id="getTotalCount" resultType="int">
	<![CDATA[
		SELECT COUNT(*) FROM board
	]]>	
	</select>
	
	<!-- 공지사항 작성 id 가져오기 -->
	<select id="getNoticeMember" resultType="edu.bit.ex.vo.MbrVO">
	<![CDATA[
		SELECT * FROM mbr WHERE mbr_id = 'abcd1234'
	]]>
	</select>
	
	<!-- 공지사항 작성 -->
	<insert id="setNoticeWrite" >
	<![CDATA[
		INSERT INTO board (board_id, board_name, board_content, mbr_id, board_type_number, inquiry_number, prdct_id, order_number, board_like, board_hit) 
		VALUES (board_seq.nextval, #{board_name}, #{board_content}, #{mbr_id}, 1, 1, 'PRDCT34', 23, 0, 0) 
	]]>
	</insert>
	
	<!-- 공지사항 게시글 -->
	<select id="getNoticeContent" resultType="edu.bit.ex.vo.BoardVO">
	<![CDATA[
		SELECT * FROM board WHERE board_id = #{board_id}
	]]>
	</select>
	
	<!-- 공지사항 삭제 -->
	<delete id="noticeRemove">
	<![CDATA[
		DELETE FROM board WHERE board_id = #{board_id}
	]]>
	</delete>
	
	<!-- 공지사항 게시글 수정 -->
	<update id="setNoticeModify">
	<![CDATA[
		UPDATE board SET board_name = #{board_name}, board_content = #{board_content} WHERE board_id = #{board_id}
	]]>
	</update>
	
	<!-- 매거진 게시판 리스트 -->
	<resultMap id="magazineBoardMap" type="edu.bit.ex.vo.BoardVO">
	    <result property="board_id" column="board_id"/>
	    <result property="board_name" column="board_name"/>
	    <result property="board_date" column="board_date"/>
	    <result property="board_like" column="board_like"/>
	    <result property="board_hit" column="board_hit"/>
		<collection property="board_type_number" resultMap="magazineBoardTypeMap"></collection>
	</resultMap>	
	<resultMap id="magazineBoardTypeMap" type="edu.bit.ex.vo.BoardTypeVO">
		<result property="board_type_number" column="board_type_number"/>
		<result property="board_type_name" column="board_type_name"/>
	</resultMap>
	<select id="getMagazineList" resultMap="magazineBoardMap">
		SELECT b.board_id, b.board_name, b.board_date, b.board_like, b.board_hit 
		FROM board b, board_type t 
		WHERE b.board_type_number = t.board_type_number AND 
		    t.board_type_name = 'MAGAZINE' 
		ORDER BY b.board_id DESC, b.board_date DESC 
	</select>
	
	<!-- 매거진 게시글 -->
	<select id="getMagazineContent" resultType="edu.bit.ex.vo.BoardVO">
	<![CDATA[
		SELECT * FROM board WHERE board_id = #{board_id}
	]]>
	</select>
</mapper>